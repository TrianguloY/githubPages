<!DOCTYPE htmls>
<html>
<style>
label{
	padding-left: 5px;
	padding-right: 5px;
}
body{
	height:95%; 
	width:95%; 
	display:flex; 
	flex-flow:column;
}
</style>
<body>

<div>
	<label>Season:
		<input id="season" type="number" min="0" max="9" value="1" onchange="updateEpisode();">
	</label>
	<label>Episode:
		<input id="episode" type="number" min="1" max="26" value="1">
	</label>
	<label id='l1'>|</label>
	<select id="quality">
		<option value="7">720p</option>
		<option value="1">1080p</option>
	</select>
	<select id="format">
		<option value="R">iTunes Raw US</option>
		<option value="S">Scootaloo Remastered x264</option>
		<option value="STB">Scootaloo Definitive HEVC</option>
		<option value="A">iTunes Raw AU</option>
		<option value="Z">Color corrected by ZR</option>
		<option value="ZA">Color corrected by ZR (alternate)</option>
		<option value="TV">TVRips (Spazz or Mentos)</option>
	</select>
	<select id="server">
		<option value="https%3A%2F%2Fdl.yayponies.no%2F">Yay Ponies</option>
		<option value="https%3A%2F%2Fyp.coco-pommel.org%2Fypvideo%2F">Coco Pommel</option>
	</select>
	<label id='l2'>|</label>
	<input type="button" onclick="reload();" value="Play">
	<a href="https://yayponies.no/videos/episodes.php">Source</a>
</div>
<video id="video" controls style="flex: 1 1 auto">
	<source id="source">
</video>

<a href="https://github.com/TrianguloY/githubPages/tree/master/Visor"><img style="position: absolute; top: 0; right: 0; border: 0;z-index:-999" src="https://github.blog/wp-content/uploads/2008/12/forkme_right_gray_6d6d6d.png?resize=149%2C149" alt="Fork me on GitHub"></a>

</body>

<script type="text/javascript">
function getValue(id){
	return document.getElementById(id).value;
}


function updateEpisode(){
	var episode = document.getElementById('episode');
	
	switch(getValue('season')){
		case '3':
			episode.max = 13;
			episode.min = 1;
			break;
		case '0':
			episode.max = 66;
			episode.min = 66;
			break;
		default:
			episode.max = 26;
			episode.min = 1;
	}
	
	episode.value = episode.value >= episode.max ? episode.max
								: episode.value <= episode.min ? episode.min
								: episode.value ;
}


var video = document.getElementById('video');
var source = document.getElementById('source');

function reload(autoplay=true){
	var season = getValue('season');
	var episode = getValue('episode');

	var quality = getValue('quality');
	var format = getValue('format');
	var server = getValue('server');

	var url = decodeURIComponent(server)+"YP-"+quality+format+"-"+season.padStart(2, "0")+"x"+episode.padStart(2, "0")+".mkv"
	console.log(url);
	
	
	var settings = window.location.toString().replace(/\?.*/,'') 
								+ "?season=" + season
								+ "&episode=" + episode
								+ "&quality=" + quality
								+ "&format=" + format
								+ "&server=" + server;
	window.history.pushState({path:settings}, url, settings)
	
	source.setAttribute('src', url);
	
	if(autoplay){
		video.load();
		video.play();
	}
}

function onError(evt){
	console.log(evt);
	if(source.getAttribute('src')!=null){
		alert("The video can't be played. Try other settings or try again later.\nurl="+source.getAttribute('src'));
	}
}
source.addEventListener('error', onError);

function onLoad(evt){
	var params = window.location.search.substring(1).split("&").forEach(function(v){
		var data = v.split("=");
		try{
			document.getElementById(data[0]).value = data[1];
		}catch(e){
		}
	});
	
	if(window.chrome == undefined){
		alert("This only seems to work with Chrome :( sorry. But you can try anyway.");
	}
	
	reload(false);
	
	document.getElementById('l1').onclick = addPonies;
	document.getElementById('l2').onclick = removePonies;
}
window.onload = onLoad;
</script>


<!-- My little easter egg -->
<script type="text/javascript" src="https://panzi.github.io/Browser-Ponies/basecfg.js" id="browser-ponies-config"></script>
<script type="text/javascript" src="https://panzi.github.io/Browser-Ponies/browserponies.js" id="browser-ponies-script">
</script><script type="text/javascript">
/* <![CDATA[ */ 
(function (cfg) {BrowserPonies.setBaseUrl(cfg.baseurl);BrowserPonies.loadConfig(BrowserPoniesBaseConfig);BrowserPonies.loadConfig(cfg);})({"baseurl":"https://panzi.github.io/Browser-Ponies/","fadeDuration":500,"volume":1,"fps":25,"speed":3,"audioEnabled":false,"showFps":false,"showLoadProgress":true,"speakProbability":0.1,"spawn":{},"spawnRandom":0,"autostart":false}); /* ]]> */
function addPonies(){
	if(!BrowserPonies.running()) BrowserPonies.start();
	BrowserPonies.spawnRandom(5);
}
function removePonies(){
	BrowserPonies.unspawnAll();
	BrowserPonies.stop();
}
</script>

</html>